import{A as Se,_ as Ee}from"./AntdIcon-Dm9H8mJU.js";import{r,e as be,j as s,c as S}from"./index-F_APLYFk.js";import{R as Fe}from"./index-BXhJrqF1.js";import{R as X}from"./index-B5rWA4tD.js";import{B as v}from"./context-BBgDGUKR.js";import{u as Ie}from"./useForm-ByqIYigZ.js";import{d as ye,l as Re,f as Oe}from"./Styles-t47KmDAN.js";import{s as Ae}from"./commonMailDomains-C8uuVB4t.js";import{F as i}from"./index-BcKRyQvd.js";import{m as f}from"./index-BZ8NrSYz.js";import{W as we}from"./WarningOutlined-D6lJ5C0F.js";import{I as m}from"./index-CF94sgcy.js";import{S as u}from"./index-DiInJGef.js";import{D as Me}from"./index-DoudlPhZ.js";var ke={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M678.3 642.4c24.2-13 51.9-20.4 81.4-20.4h.1c3 0 4.4-3.6 2.2-5.6a371.67 371.67 0 00-103.7-65.8c-.4-.2-.8-.3-1.2-.5C719.2 505 759.6 431.7 759.6 349c0-137-110.8-248-247.5-248S264.7 212 264.7 349c0 82.7 40.4 156 102.6 201.1-.4.2-.8.3-1.2.5-44.7 18.9-84.8 46-119.3 80.6a373.42 373.42 0 00-80.4 119.5A373.6 373.6 0 00137 888.8a8 8 0 008 8.2h59.9c4.3 0 7.9-3.5 8-7.8 2-77.2 32.9-149.5 87.6-204.3C357 628.2 432.2 597 512.2 597c56.7 0 111.1 15.7 158 45.1a8.1 8.1 0 008.1.3zM512.2 521c-45.8 0-88.9-17.9-121.4-50.4A171.2 171.2 0 01340.5 349c0-45.9 17.9-89.1 50.3-121.6S466.3 177 512.2 177s88.9 17.9 121.4 50.4A171.2 171.2 0 01683.9 349c0 45.9-17.9 89.1-50.3 121.6C601.1 503.1 558 521 512.2 521zM880 759h-84v-84c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v84h-84c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h84v84c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-84h84c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"user-add",theme:"outlined"};const De=ke;var Ne=function(j,h){return r.createElement(Se,Ee({},j,{ref:h,icon:De}))};const Xe=r.forwardRef(Ne);function Ze({isVisible:x,onClose:j,initialData:h,onProfessionalSaved:I}){const[Z,qe]=r.useState(!1),[y,R]=r.useState(""),[O,A]=r.useState(""),[ee,w]=r.useState(null),[C,M]=r.useState(""),[k,D]=r.useState(""),[se,ae]=r.useState([]),[re,te]=r.useState(null),[N,q]=r.useState(null),[_,T]=r.useState(null),[L,$]=r.useState(""),[E,U]=r.useState(""),[Y,B]=r.useState(""),[oe,W]=r.useState(""),[ne,ie]=r.useState([]),[le,z]=r.useState([]),[ce,P]=r.useState(!1),[p,b]=r.useState(0),[F,ue]=r.useState(x),[l]=Ie(),[V,G]=r.useState([]),{authData:H}=be(),J=H.companyID,n=H.userSpecialties||[],de=e=>{const a=e.target.value,t=Ae(a);G(t)},me=e=>{l.setFieldsValue({email:e}),G([])},he=()=>{const e=[];return n!=null&&n.includes(1)&&e.push(s.jsx(u.Option,{value:"CRM",children:"CRM"})),n!=null&&n.includes(2)&&e.push(s.jsx(u.Option,{value:"CRO",children:"CRO"})),n!=null&&n.includes(3)&&e.push(s.jsx(u.Option,{value:"CRP",children:"CRP"})),n!=null&&n.includes(4)&&e.push(s.jsx(u.Option,{value:"CREFITO",children:"CREFITO"})),n!=null&&n.includes(5)&&e.push(s.jsx(u.Option,{value:"CRN",children:"CRN"})),n!=null&&n.includes(6)&&e.push(s.jsx(u.Option,{value:"CFFA",children:"CFFA"})),e},fe=()=>{p<3&&b(e=>e+1)},ge=()=>{p>0&&b(e=>e-1)},pe=async()=>{try{await l.validateFields(),fe()}catch{f.error("Por favor, preencha todos os campos.")}},ve=e=>{if(e=e.replace(/[^\d]+/g,""),e.length!==11||e.match(/(\d)\1{10}/))return!1;let a=0,t;for(let o=1;o<=9;o++)a=a+parseInt(e.substring(o-1,o))*(11-o);if(t=a*10%11,(t===10||t===11)&&(t=0),t!==parseInt(e.substring(9,10)))return!1;a=0;for(let o=1;o<=10;o++)a=a+parseInt(e.substring(o-1,o))*(12-o);return t=a*10%11,(t===10||t===11)&&(t=0),t===parseInt(e.substring(10,11))},xe=async e=>{if(!e){P(!1);return}try{const a=await S.get(`/professionals/check-login/${e}`);P(a.data.existe)}catch(a){console.error("Erro ao verificar o login:",a)}finally{l.validateFields(["login"])}},je=()=>{switch(p){case 0:return s.jsxs(s.Fragment,{children:[s.jsx(Oe,{name:"nome",label:"Nome",rules:[{required:!0,message:"Por favor, insira o nome!"}],children:s.jsx(m,{value:y,onChange:e=>R(e.target.value)})}),s.jsx(i.Item,{name:"cpf",label:"CPF",rules:[{required:!0,message:"Por favor, insira o CPF!"},{validator:(e,a)=>ve(a)?Promise.resolve():Promise.reject(new Error("CPF inválido!"))}],children:s.jsx(X,{mask:"999.999.999-99",value:O,onChange:e=>A(e.target.value.replace(/_/g,"")),beforeMaskedValueChange:(e,a,t)=>{var{value:o}=e,d=e.selection,c=d?d.start:null;return o.endsWith("-")&&t!=="-"&&c===o.length-1&&(c=o.length-2),{value:o,selection:{start:c,end:c}}},children:e=>s.jsx(m,{...e})})}),s.jsx(i.Item,{name:"dataNascimento",label:"Data de Nascimento",rules:[{required:!0,message:"Por favor, insira a data de nascimento!"}],children:s.jsx(Me,{format:"DD/MM/YYYY",onChange:w})}),s.jsx(i.Item,{name:"celular",label:"Celular",rules:[{required:!0,message:"Por favor, insira seu número de celular!"}],children:s.jsx(X,{mask:"(99) 9 9999-9999",value:L,onChange:e=>$(e.target.value.replace(/_/g,"")),placeholder:"(99) 9 9999-9999",children:e=>s.jsx(m,{...e,type:"tel"})})}),s.jsx(i.Item,{name:"email",label:"E-Mail",rules:[{required:!0,message:"Por favor, insira o email!"}],children:s.jsx(m,{onChange:de})}),V.length>0&&s.jsx("div",{style:{marginTop:"0.5rem",background:"#f7f7f7",padding:"0.5rem"},children:V.map((e,a)=>s.jsx("div",{onClick:()=>me(e),style:{cursor:"pointer",padding:"0.5rem"},children:e},a))})]});case 1:return s.jsxs(s.Fragment,{children:[s.jsx(i.Item,{name:"registro",label:"Registro",rules:[{required:!0,message:"Por favor, selecione o registro!"}],children:s.jsx(u,{onChange:M,placeholder:"Selecione Tipo de Registro",children:he()})}),C&&s.jsx(i.Item,{name:"numeroRegistro",label:`Número do ${C}`,rules:[{required:!0,message:`Por favor, insira o número do ${C}!`}],children:s.jsx(m,{value:k,onChange:e=>D(e.target.value)})}),s.jsx(i.Item,{name:"estadoProfissional",label:"Estado",rules:[{required:!0,message:"Por favor, selecione um estado!"}],children:s.jsx(u,{value:N,onChange:q,placeholder:"Selecione um estado",children:se.map(e=>s.jsx(u.Option,{value:e.sigla,children:e.sigla},e.id))})}),s.jsx(i.Item,{name:"titulo",label:"Título",rules:[{required:!0,message:"Por favor, insira um Título, Ex. Cirugião Plástico"}],children:s.jsx(m,{value:_,onChange:e=>T(e.target.value)})}),s.jsx(i.Item,{name:"planosSaude",label:"Planos de Saúde",rules:[{required:!0,message:"Por favor, selecione pelo menos um plano de saúde!"}],children:s.jsx(u,{mode:"multiple",showSearch:!0,placeholder:"Selecione os planos de saúde",optionFilterProp:"label",filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),onChange:e=>z(e),options:ne.map(e=>({label:e.nome,value:e.id}))})})]});case 2:return s.jsxs(s.Fragment,{children:[s.jsxs(Re,{children:[s.jsx(we,{style:{color:"red",fontSize:"18px"}}),s.jsx("p",{children:" O login e senha criados a seguir serão usados para emitir atestados e declarações em seu nome, portanto não compartilhe essa senha!"})]}),s.jsx(i.Item,{name:"login",label:"Login",rules:[{required:!0,message:"Por favor, insira um login!"},()=>({validator(e,a){return ce?Promise.reject(new Error("Nome de usuário já está em uso, por favor escolha outro !")):Promise.resolve()}})],children:s.jsx(m,{value:E,onChange:e=>{U(e.target.value),P(!1),l.validateFields(["login"])},onBlur:()=>xe(E)})}),s.jsx(i.Item,{name:"senha",label:"Senha",rules:[{required:!0,message:"Por favor, insira uma senha!"},{min:6,message:"A senha deve ter pelo menos 6 caracteres"}],children:s.jsx(m.Password,{value:Y,onChange:e=>B(e.target.value)})}),s.jsx(i.Item,{name:"confirmacaoSenha",label:"Confirmação da Senha",dependencies:["senha"],hasFeedback:!0,rules:[{required:!0,message:"Por favor, confirme sua senha!"},({getFieldValue:e})=>({validator(a,t){return!t||e("senha")===t?Promise.resolve():Promise.reject(new Error("As senhas não correspondem!"))}})],children:s.jsx(m.Password,{value:oe,onChange:e=>W(e.target.value)})})]});case 3:return s.jsx(s.Fragment,{children:s.jsxs(i.Item,{label:"Assinatura",children:[s.jsx("div",{style:{border:"1px solid black",width:500,marginBottom:"10px"},children:s.jsx(Fe,{ref:g,canvasProps:{width:500,height:200,className:"signatureCanvas"}})}),s.jsx(v,{onClick:Ce,children:"Limpar"}),s.jsx(v,{onClick:Pe,style:{marginLeft:"10px"},children:"Salvar Assinatura"})]})});default:return null}},K=async()=>{try{if(!J){f.error("ID da empresa não encontrado. Faça o login novamente.");return}const e=`${C} ${N} - ${k}`,t=g.current.getTrimmedCanvas().toDataURL("image/png").split(",")[1],o={nome:y,cpf:O,data_de_nascimento:ee.format("DD/MM/YYYY"),celular:L,registro_profissional:e,titulo:_,assinatura:t,estado:re,planosaude_id:le,company_id:J,login:E,senha:Y,email:l.getFieldValue("email")};let d;if(Z&&h){const c=await S.put(`/professionals/${h.id}`,o);f.success("Profissional atualizado com sucesso!"),d=c.data,I(d)}else{const c=await S.post("/professionals",o);c.status===400&&c.data.error==="Nome de usuário não está disponível!"?f.error("Nome de usuário não está disponível!"):(f.success("Profissional salvo com sucesso!"),d=c.data,I(d))}j()}catch(e){console.error("Erro ao salvar profissional:",e),e.response?f.error(`Erro ao salvar profissional: ${e.response.status} ${e.response.statusText}`):f.error("Erro ao salvar profissional")}},[_e,Q]=r.useState(""),g=r.useRef(null),Ce=()=>{g.current&&(g.current.clear(),Q(""))},Pe=()=>{if(g.current){const a=g.current.getTrimmedCanvas().toDataURL("image/png").split(",")[1];Q(a),f.success("Assinatura salva com sucesso!")}};return r.useEffect(()=>{fetch("https://servicodados.ibge.gov.br/api/v1/localidades/estados").then(e=>e.json()).then(e=>ae(e)).catch(e=>console.error("Erro ao buscar estados:",e))},[]),r.useEffect(()=>{ue(x)},[x]),r.useEffect(()=>{h?l.setFieldsValue(h):l.resetFields()},[h,l]),r.useEffect(()=>{(async()=>{try{const a=await S.get("/planos_medicos");if(a.data&&a.data.length>0){const t=a.data.sort((o,d)=>o.nome==="Particular"?-1:d.nome==="Particular"?1:0);ie(t)}}catch(a){console.error("Erro ao buscar planos de saúde:",a)}})()},[]),r.useEffect(()=>{F||(l.resetFields(),R(""),A(""),w(null),M(""),D(""),te(null),q(null),T(null),$(""),U(""),B(""),W(""),z([]),P(!1),b(0))},[F,l]),s.jsx(ye,{title:h?"Editar Profissional":"Adicionar Profissional",open:F,onCancel:j,footer:null,width:800,onOk:()=>{l.validateFields().then(e=>{l.resetFields(),K()}).catch(e=>{})},children:s.jsxs(i,{layout:"vertical",form:l,children:[je(),s.jsxs("div",{style:{marginTop:"20px",display:"flex",justifyContent:"space-between"},children:[p>0&&s.jsx(v,{onClick:ge,children:"Anterior"}),p<3?s.jsx(v,{type:"primary",onClick:pe,children:"Próxima"}):s.jsx(v,{type:"primary",onClick:K,children:"Salvar Cadastro"})]})]})})}export{Ze as P,Xe as U};
