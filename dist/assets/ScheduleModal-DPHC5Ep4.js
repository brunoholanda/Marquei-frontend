import{r as o,e as je,j as e,c as f,N as ze}from"./index-DtAKxO-I.js";import{S as ee,a as We,b as Ge,D as B,c as Je,d as Ke,e as Qe,f as v,g as fe,h as Xe,i as Ze,j as ea,k as pe}from"./Styles-B5msiCGj.js";import{M as U}from"./index-53RB1vmR.js";import{B as g}from"./context-DBlOovQj.js";import{D as aa}from"./index-gnFUhh9P.js";import{T as sa}from"./index-Cpu2Yaof.js";import{s as k}from"./index-BvngcNS3.js";import{m as p}from"./index-ckeLVLhX.js";import{h as N}from"./moment-gy9AvL1k.js";import{R as oa}from"./index-BFpPU777.js";import{H as ra}from"./Holidays-DVOs2uW5.js";import{U as ta,P as na}from"./registerModal-BbWUxbbS.js";import ia from"./index-Bk7dcu8M.js";import{A as la}from"./AddClientsModal-C_63WXIQ.js";import{C as he}from"./index-C2nHqenG.js";import{s as ca}from"./commonMailDomains-C8uuVB4t.js";import{F as ge}from"./index-DVTGV1Ty.js";import{c as da}from"./AntdIcon-yIvRgVWP.js";import{t as ma,C as ua,o as fa}from"./useSize-CI_ZKiRx.js";import{g as pa}from"./PurePanel-DTnqM39y.js";import{i as xe}from"./render-DxYmgcxZ.js";import{S as L}from"./index-DsB5NFMg.js";import{I as ae}from"./index-Bh7spuOb.js";import{R as ye}from"./index-DBBspAOI.js";import{C as ha}from"./index-BZp-_p2x.js";const{Option:se}=L;function be(b){return b&&b.type&&(b.type.isSelectOption||b.type.isSelectOptGroup)}const ga=(b,Y)=>{const{prefixCls:c,className:S,popupClassName:l,dropdownClassName:$,children:h,dataSource:w}=b,j=ma(h);let _;j.length===1&&xe(j[0])&&!be(j[0])&&([_]=j);const H=_?()=>_:void 0;let C;j.length&&be(j[0])?C=h:C=w?w.map(x=>{if(xe(x))return x;switch(typeof x){case"string":return o.createElement(se,{key:x,value:x},x);case"object":{const{value:d}=x;return o.createElement(se,{key:d,value:d},x.text)}default:return}}):[];const{getPrefixCls:O}=o.useContext(ua),E=O("select",c);return o.createElement(L,Object.assign({ref:Y,suffixIcon:null},fa(b,["dataSource","dropdownClassName"]),{prefixCls:E,popupClassName:l||$,className:da(`${E}-auto-complete`,S),mode:L.SECRET_COMBOBOX_MODE_DO_NOT_USE,getInputElement:H}),C)},z=o.forwardRef(ga),xa=pa(z);z.Option=se;z._InternalPanelDoNotUseOrYouWillBeFired=xa;const ya=z,Wa=({isModalVisible:b,setIsModalVisible:Y,currentAppointment:c,handleClose:S})=>{const[l,$]=o.useState(null),[h,w]=o.useState(null),[j,_]=o.useState(""),[H,C]=o.useState(!1),[O,E]=o.useState(!1),{authData:x}=je(),d=x.companyID,I=()=>{E(!0)},D=()=>{C(!1)},R=async()=>{try{const i=await f.delete(`/agendamentos/${c.id}`);i.data&&i.data.success?(k.success({message:"Agendamento excluído com sucesso!"}),D(),S()):p.error("Erro ao excluir o agendamento.")}catch(i){console.error("Erro ao excluir o agendamento",i),p.error("Erro ao excluir o agendamento")}},W=()=>{E(null),$(null),w(null)},T=async()=>{try{const i=await f.put(`/agendamentos/${c.id}`,{status:1});i.data&&i.data.success?k.success({message:"Agendamento confirmado com sucesso!"}):k.error({message:"Erro ao confirmar o agendamento."})}catch(i){console.error("Erro ao confirmar o agendamento",i),p.error("Erro ao confirmar o agendamento")}S()},oe=async()=>{try{const i=await f.put(`/agendamentos/${c.id}`,{status:2});i.data&&i.data.success?k.success({message:"Agendamento cancelado com sucesso!"}):p.error("Erro ao cancelar o agendamento.")}catch(i){console.error("Erro ao cancelar o agendamento",i),p.error("Erro ao cancelar o agendamento")}S()},V=async()=>{if(!l||!h){k.error({message:"Por favor, selecione a data e horário para reagendar."});return}try{const i=await f.put(`/agendamentos/${c.id}`,{data:l.format("DD/MM/YYYY"),horario:h.format("HH:mm")});i.data&&i.data.success?(k.success({message:"Agendamento reagendado com sucesso!"}),W()):p.error("Erro ao reagendar.")}catch(i){console.error("Erro ao reagendar",i),p.error("Erro ao reagendar")}S()},G=(i,P)=>{k[i]({message:P})};return o.useEffect(()=>{(async()=>{if(d)try{const P=await f.get(`/companies/${d}`);_(P.data.nome)}catch(P){console.error("Erro ao buscar nome do consultório:",P),G("error","Erro ao buscar nome do consultório.")}})()},[d]),e.jsxs(e.Fragment,{children:[e.jsxs(U,{title:"O que você gostaria de fazer com este agendamento?",open:b,onCancel:S,footer:[e.jsxs(ee,{children:[e.jsx(g,{className:"button-orange modal-btn",onClick:I,children:"Reagendar"},"reschedule"),e.jsx(g,{type:"primary",className:"button-green modal-btn",onClick:T,children:"Confirmar"},"submit"),e.jsx(g,{className:"button-red modal-btn",onClick:oe,children:"Cancelar Agendamento"},"cancelAppointment")]})],children:[c&&e.jsx(We,{children:e.jsxs("p",{children:[e.jsx("b",{children:"Nome:"})," ",c.nome,e.jsx("br",{}),e.jsx("b",{children:"Telefone:"})," ",c.celular,e.jsx("br",{}),e.jsx("b",{children:"Data:"})," ",c.data,e.jsx("br",{}),e.jsx("b",{children:"Horário:"})," ",c.horario,e.jsx("br",{}),e.jsx("b",{children:"Plano:"})," ",c.planodental]})}),e.jsx(Ge,{children:c&&e.jsx(g,{className:"button-whats modal-btn",onClick:()=>{const i=`Oi, sou do consultório ${j} e estou falando aqui para saber se você deseja confirmar sua consulta agendada para ${c.data} às ${c.horario}?`,P=c.celular.replace(/[^0-9]/g,"");window.open(`https://api.whatsapp.com/send?phone=+55${P}&text=${encodeURIComponent(i)}`,"_blank")},children:"Enviar WhatsApp"},"whatsapp")})]}),e.jsxs(U,{title:"Tem certeza de que deseja excluir este agendamento? 😱",open:H,onOk:R,onCancel:D,okText:"Sim",cancelText:"Não",footer:[e.jsxs(ee,{children:[e.jsx(g,{onClick:D,children:"Não"},"cancel"),e.jsx(g,{type:"primary",onClick:R,style:{backgroundColor:"red",borderColor:"red",color:"white"},children:"Sim"},"submit")]})],children:[e.jsx(B,{}),e.jsx("p",{children:"Após esta ação você não poderá recuperar os dados desse agendamento!"}),e.jsx("p",{children:"Caso seja um novo cliente, seus dados continuaram salvos no Menu Clientes."}),e.jsx(B,{})]}),e.jsxs(U,{title:"Reagendar Agendamento ⚠️",open:O,onCancel:()=>E(!1),footer:[e.jsxs(ee,{children:[e.jsx(g,{onClick:()=>E(!1),children:"Voltar"},"back"),e.jsx(g,{type:"primary",onClick:V,children:"Salvar Reagendamento"},"submit")]})],children:[e.jsx("p",{children:"Como administrador da clinica você pode reagendar para qualquer horário, portanto certifique-se de que jé não existe alguem para a data e horários selecionados !"}),e.jsx(B,{}),e.jsxs(Je,{children:[e.jsx(aa,{format:"DD/MM/YYYY",value:l,onChange:$}),e.jsx(sa,{format:"HH:mm",value:h,onChange:w,minuteStep:15})]}),e.jsx(B,{})]})]})},{Option:Se}=L,{TextArea:ba}=ae,Ga=({isModalAgendaVisible:b,handleCancel:Y,start:c,end:S})=>{const[l]=ge.useForm(),[$,h]=o.useState(!1),[w,j]=o.useState([]),[_,H]=o.useState([]),[C,O]=o.useState([]),[E,x]=o.useState([]),[d,I]=o.useState(null),[D,R]=o.useState(!1),[W,T]=o.useState([]),[oe,V]=o.useState(null),[G,i]=o.useState([]),[P,re]=o.useState(!1),[Ce,J]=o.useState(!1),[K,Ee]=o.useState(null),[De,Pe]=o.useState(!1),{authData:F}=je(),M=F.companyID,Me=F.userSpecialties||[],[te,ne]=o.useState([]),[q,ve]=o.useState(null),[Q,we]=o.useState([]),[Sa,ke]=o.useState({}),[ie,ja]=o.useState([]),He=a=>{const s=a.target.value,t=ca(s);ne(t)},Ie=a=>{l.setFieldsValue({email:a}),ne([])},Ae=async a=>{if(a.length<4){T([]);return}try{if(M){const r=(await f.get("/clients-name",{params:{company_id:M}})).data.filter(n=>n.nome.toLowerCase().includes(a.toLowerCase())).map(n=>({label:n.nome,value:n.nome,data:n}));T(r)}else console.error("Company ID not found in context")}catch(s){console.error("Erro ao buscar pacientes",s),p.error("Erro ao buscar pacientes")}},Ne=(a,s)=>{var t,r,n;V(s==null?void 0:s.data),l.setFieldsValue({email:(t=s.data)==null?void 0:t.client_email,celular:(r=s.data)==null?void 0:r.celular,planodental:(n=s.data)==null?void 0:n.planodental})},le=new ra;le.init("BR");const _e=a=>le.getHolidays(a.year()).some(t=>{const r=new Date(t.date);return r.getDate()===a.date()&&r.getMonth()===a.month()&&r.getFullYear()===a.year()}),ce={Segunda:1,Terça:2,Quarta:3,Quinta:4,Sexta:5,Sábado:6,Domingo:0};o.useEffect(()=>{c&&l.setFieldsValue({data:N(c),horario:N(c)}),S&&l.setFieldsValue({end_time:N(S)})},[c,S,l]),o.useEffect(()=>{d&&(async()=>{try{let s={professional_id:d};Q.length>0&&q&&(s.endereco_id=q);const t=await f.get("/dias-semanais",{params:s});j(t.data)}catch(s){console.error("Erro ao buscar dias da semana",s)}})()},[d,q,Q.length]);const Oe=()=>{ze("/upgrade"),J(!1)},de=()=>{J(!1)},Fe=a=>{const s=a.day(),t=w.find(r=>ce[r.dia]===s);return!t||!t.ativo?!0:_e(a)},X=(a,s)=>{if(!a||D)return[];const t=a.day(),r=w.find(y=>ce[y.dia]===t),n=[];if(!r||!r.ativo)return[...Array(24).keys()];const m=r.startam?parseInt(r.startam.split(":")[0],10):0,u=r.endam?parseInt(r.endam.split(":")[0],10):11,A=r.startpm?parseInt(r.startpm.split(":")[0],10):12,Le=r.endpm?parseInt(r.endpm.split(":")[0],10):23;for(let y=0;y<24;y++)(y<m||y>=u&&y<A||y>Le)&&n.push(y);return s.forEach(y=>{n.includes(y)||n.push(y)}),n},Ye=async a=>{const s=a.format("DD/MM/YYYY");if(d&&!D)try{const r=(await f.get("/agendamentos",{params:{data:s,professional_id:d}})).data.map(n=>N(n.horario,"HH:mm").hour());O(r)}catch(t){console.error("Erro ao buscar horários agendados",t),p.error("Erro ao buscar horários agendados")}H(X(a,C))};o.useEffect(()=>{l.getFieldValue("data")&&H(X(l.getFieldValue("data"),C))},[D,C,l]),o.useEffect(()=>{d&&(async()=>{try{const t=(await f.get(`/enderecos/professional/${d}`)).data||[];if(we(t),t.length===1){const r=t[0].id,n=ie.reduce((m,u)=>(m[u.id]=r,m),{});ke(n)}}catch(s){console.error("Erro ao carregar endereços:",s),p.error("Erro ao carregar endereços.")}})()},[d,ie]);const $e=async a=>{h(!0);try{const s={nome:a.nome,client_email:a.email,celular:a.celular.replace(/\D/g,""),planodental:a.planodental,company_id:M},t=a.data.format("DD/MM/YYYY"),r=a.horario.format("HH:mm"),n=a.end_time.format("HH:mm"),m={...a,data:t,horario:r,end_time:n,professional_id:d,company_id:M};let u=await f.get(`/clients/email/${s.client_email}?company_id=${s.company_id}`).catch(A=>A.response);if(u&&u.status===404&&(u=await f.post("/clients",s)),u&&u.data&&u.data.id){m.client_id=u.data.id;const A=await f.post("/agendamentos",m);A.data&&A.data.error?p.error(A.data.error):(k.success({message:"Agendamento feito com sucesso!"}),l.resetFields(),Z())}else throw console.error("Erro na resposta do cliente:",u),new Error(u.data.message||"Erro ao criar ou recuperar o cliente.")}catch(s){console.error("Erro no processo de agendamento:",s),p.error(s.message||"Erro ao enviar o agendamento")}finally{h(!1)}},[Re,me]=o.useState([]);o.useEffect(()=>{(async()=>{if(!d){me([]);return}try{const t=(await f.get(`/disabledDates?professional_id=${d}`)).data.map(r=>({date:N(r.date,"DD/MM/YYYY"),allDay:r.allday,startTime:r.starttime,endTime:r.endtime}));me(t)}catch(s){console.error("Erro ao buscar datas desabilitadas",s)}})()},[d]);const Te=a=>{if(D)return!1;const s=Re.find(t=>a.isSame(t.date,"day"));return a&&(a<N().startOf("day")||Fe(a)||s&&s.allDay)},Z=()=>{l.resetFields(["data","horario","nome","email","celular","planodental","motivo","end_time"]),R(!1),H([]),O([]),I(null),T([]),V(null),Y()};o.useEffect(()=>{(async()=>{try{h(!0);const s=await f.get(`/professionals?company_id=${M}`);if(s.status!==200)throw new Error("Falha ao buscar dados dos profissionais");const r=he.AES.decrypt(s.data,"%A0533266q6td9g*"),n=JSON.parse(r.toString(he.enc.Utf8));if(x(n),n.length===1){const m=n[0].id;I(m);const u=await ue(m);i(u),l.setFieldsValue({professional:m,planodental:""})}}catch(s){console.error("Error fetching professionals:",s),p.error("Erro ao buscar dados dos profissionais")}finally{h(!1)}})()},[M]);const ue=async a=>{try{const s=await f.get(`/professionals/${a}/planos`);if(s.status===200)return s.data;throw new Error("Falha ao buscar planos de saúde do profissional")}catch(s){return console.error("Erro ao buscar planos de saúde",s),p.error("Erro ao buscar planos de saúde"),[]}},Ve=()=>{if(E.length>=K){J(!0);return}I(null),re(!0)},qe=()=>{re(!1),I(null)};o.useEffect(()=>{(async()=>{if(M&&F.authToken){h(!0);try{const t=(await f.get(`/companies/${M}`,{headers:{Authorization:`Bearer ${F.authToken}`}})).data.service_id,r=await f.get(`/service_details/${t}`,{headers:{Authorization:`Bearer ${F.authToken}`}});Ee(r.data.persons)}catch(s){console.error("Erro ao buscar o número máximo de profissionais:",s),p.error("Erro ao buscar informações do serviço")}finally{h(!1)}}})()},[M,F.authToken]);const Be=()=>{Z(),Y()},Ue=a=>{ve(a.target.value)};return e.jsxs(Ke,{title:"Agendar Consulta Para Paciente 👩‍⚕️",open:b,onCancel:Be,footer:[e.jsx(g,{onClick:Z,children:"Cancelar"},"back"),e.jsx(g,{type:"primary",onClick:()=>l.submit(),children:"Agendar"},"submit")],style:{top:"5%"},children:[e.jsxs(ge,{form:l,name:"agendamento",layout:"vertical",onFinish:$e,children:[e.jsx(Qe,{children:e.jsx(v,{name:"nome",rules:[{required:!0,message:"Por favor, insira o nome do paciente!"}],children:e.jsx(ya,{placeholder:"🔍 Nome do paciente",onSearch:Ae,onSelect:Ne,options:W,style:{width:"100%"}})})}),e.jsx(v,{name:"email",label:"E-mail",rules:[{required:!0,message:"Por favor, insira seu e-mail!"},{type:"email",message:"Por favor, insira um e-mail válido!"}],children:e.jsx(ae,{placeholder:"Seu e-mail",onChange:He})}),te.length>0&&e.jsx("div",{style:{marginTop:"0.5rem",background:"#f7f7f7",padding:"0.5rem"},children:te.map((a,s)=>e.jsx("div",{onClick:()=>Ie(a),style:{cursor:"pointer",padding:"0.5rem"},children:a},s))}),e.jsx(fe,{showSearch:!0,style:{width:200,marginBottom:20},placeholder:"Selecione um profissional",optionFilterProp:"children",onChange:async a=>{if(a){I(a);const s=await ue(a);i(s),l.setFieldsValue({planodental:""})}},filterOption:(a,s)=>s.children.toLowerCase().indexOf(a.toLowerCase())>=0,value:d,children:E.map(a=>e.jsx(Se,{value:a.id,children:a.nome},a.id))}),e.jsxs(g,{style:{margin:"0 10px 10px 10px"},type:"primary",onClick:Ve,children:[e.jsx(ta,{}),"Adicionar Profissional"]}),e.jsx("div",{style:{margin:"10px 0"},children:e.jsx(ye.Group,{onChange:Ue,value:q,children:Q.map(a=>e.jsx(ye,{value:a.id,children:`${a.rua}, ${a.numero} - ${a.cidade}/${a.uf}`},a.id))})}),e.jsx(na,{isVisible:P,onClose:qe,initialData:d,userSpecialties:Me}),e.jsx(v,{name:"ignoreDisabledHours",valuePropName:"checked",children:e.jsx(ha,{onChange:a=>R(a.target.checked),children:"Ignorar Horários Desabilitados e ja Agendados"})}),e.jsx(Xe,{children:e.jsx(v,{name:"data",label:"Data",rules:[{required:!0,message:"Por favor, selecione uma data!"}],children:e.jsx(Ze,{format:"DD/MM/YYYY",disabledDate:Te,onChange:Ye},D?"ignore":"normal")})}),e.jsxs(ea,{children:[e.jsx(v,{name:"horario",label:"Horário de Início",rules:[{required:!0,message:"Por favor, selecione um horário!"}],children:e.jsx(pe,{format:"HH:mm",minuteStep:5,disabledTime:()=>({disabledHours:()=>X(l.getFieldValue("data"),C)})})}),e.jsx(v,{name:"end_time",label:"Horário Final",rules:[{required:!0,message:"Por favor, selecione o horário final!"}],children:e.jsx(pe,{format:"HH:mm",minuteStep:5,disabledTime:()=>{const a=l.getFieldValue("horario"),s=a?N(a,"HH:mm"):null;return{disabledHours:()=>{const n=[];for(let m=0;m<24;m++)s&&m<s.hour()&&n.push(m);return n},disabledMinutes:n=>{const m=[];if(s&&n===s.hour())for(let u=0;u<=s.minute();u++)m.push(u);return m}}}})})]}),e.jsx(v,{name:"planodental",rules:[{required:!0,message:"Por favor, selecione uma forma de pagamento!"}],children:e.jsx(fe,{placeholder:"Forma de pagamento",children:G.map(a=>e.jsx(Se,{value:a.nome,children:a.nome},a.id))})}),e.jsx(v,{name:"celular",label:"Celular",rules:[{required:!0,message:"Por favor, insira seu número de celular!"}],children:e.jsx(oa,{mask:"(99) 9 9999-9999",placeholder:"(99) 9 9999-9999",children:a=>e.jsx(ae,{...a,type:"tel"})})}),e.jsx(v,{name:"motivo",label:"Motivo da Consulta",rules:[{required:!0,message:"Por favor, descreva o motivo da consulta!"}],children:e.jsx(ba,{placeholder:"Descreva o motivo da consulta em poucas palavras",rows:2,maxLength:90})})]}),e.jsxs(U,{title:"Limite de Profissionais Atingido",open:Ce,onCancel:de,footer:[e.jsx(g,{onClick:de,children:"Cancelar"},"back"),e.jsx(g,{type:"primary",onClick:Oe,children:"Fazer Upgrade"},"submit")],children:[e.jsxs("p",{children:["Seu plano contratado só permite até ",K," profissionais. Caso sua clínica esteja crescendo, faça um upgrade do seu plano."]}),e.jsx(ia,{maxProfessionals:K})]}),e.jsx(la,{isModalAddClientsVisible:De,onCloseAddClients:()=>Pe(!1)})]})};export{Wa as A,Ga as S};
