import{r as u,e as Y,j as s,c as g}from"./index-DtAKxO-I.js";import{R as P}from"./index-BFpPU777.js";import{s as B}from"./commonMailDomains-C8uuVB4t.js";import{m as T,M as V,D as S,n as U,o as v,A as z}from"./Styles-B5msiCGj.js";import{F as i}from"./index-DVTGV1Ty.js";import{I as f}from"./index-Bh7spuOb.js";import{D as G}from"./index-gnFUhh9P.js";import{S as F}from"./index-DsB5NFMg.js";import{B as E}from"./context-DBlOovQj.js";import{s as b}from"./index-BvngcNS3.js";import{m as H}from"./index-ckeLVLhX.js";function J(o){let n,d,t,a,l,m;if(m=1,o.length<11)return!1;for(a=0;a<o.length-1;a++)if(o.charAt(a)!=o.charAt(a+1)){m=0;break}if(!m){for(n=o.substring(0,9),d=o.substring(9),t=0,a=10;a>1;a--)t+=n.charAt(10-a)*a;if(l=t%11<2?0:11-t%11,l!=d.charAt(0))return!1;for(n=o.substring(0,10),t=0,a=11;a>1;a--)t+=n.charAt(11-a)*a;return l=t%11<2?0:11-t%11,l==d.charAt(1)}return!1}const{Option:y}=F,oe=({isModalAddClientsVisible:o,onCloseAddClients:n,onClientAdded:d})=>{const[t]=i.useForm(),[a,l]=u.useState([]),[m,h]=u.useState([]),[p,x]=u.useState(""),[j,C]=u.useState([]),{authData:I}=Y(),w=I.companyID,k=e=>{const r=e.target.value,c=B(r);C(c)},M=e=>{t.setFieldsValue({email:e}),C([])},D=()=>{n()},A=e=>e.replace(/[^\d]/g,""),q=async()=>{try{const e=await t.validateFields();let r=e.planodental;a.find(R=>R.nome===r)||await g.post("/planos_medicos",{nome:r});const O=A(e.cpf),L=await g.post("/clients",{...e,planodental:r,cpf:O,company_id:w});d(L.data),b.success({message:"Cliente cadastrado com sucesso!"}),n(),t.resetFields()}catch(e){console.error("Erro ao tentar salvar o cliente:",e),b.error({message:"CPF do Cliente já cadastrado !"})}};u.useEffect(()=>{(async()=>{try{const r=await g.get("/planos_medicos");if(r.status===200)l(r.data),h(r.data);else throw new Error("Falha ao buscar planos de saúde")}catch(r){console.error("Erro ao buscar planos de saúde",r),H.error("Erro ao buscar planos de saúde")}})()},[]);const N=e=>{if(x(e),!e)h(a);else{const r=a.filter(c=>c.nome.toLowerCase().includes(e.toLowerCase()));h(r)}},_=e=>{x(e)};return s.jsxs(T,{title:s.jsx(V,{children:"Cadastrar Novo Cliente"}),open:o,onCancel:n,footer:null,width:750,children:[s.jsx(S,{}),s.jsxs(U,{form:t,layout:"vertical",children:[s.jsx(i.Item,{name:"nome",label:"Nome",rules:[{required:!0,message:"Por favor, insira o Nome!"}],children:s.jsx(f,{})}),s.jsxs(v,{children:[s.jsx(i.Item,{name:"data_nascimento",label:"Data de Nascimento",rules:[{required:!0,message:"Por favor, insira a data de nasciemnto!"}],children:s.jsx(G,{format:"DD/MM/YYYY"})}),s.jsx(i.Item,{name:"celular",label:"Telefone",rules:[{required:!0,message:"Por favor, insira seu telefone!"}],children:s.jsx(P,{mask:"(99) 9 9999-9999",children:e=>s.jsx(f,{...e,placeholder:"(99) 9 9999-9999"})})})]}),s.jsxs(v,{children:[s.jsx(i.Item,{name:"client_email",label:"E-Mail",rules:[{required:!0,message:"Por favor, insira o email!"}],className:"emailinput",children:s.jsx(f,{onChange:k})}),j.length>0&&s.jsx("div",{style:{marginTop:"0.5rem",background:"#f7f7f7",padding:"0.5rem"},children:j.map((e,r)=>s.jsx("div",{onClick:()=>M(e),style:{cursor:"pointer",padding:"0.5rem"},children:e},r))}),s.jsx(i.Item,{name:"planodental",label:"Plano",rules:[{required:!0,message:"Por favor, insira a forma de pagamento!"}],children:s.jsxs(F,{showSearch:!0,placeholder:"Selecione ou digite o plano",onSearch:N,onSelect:_,filterOption:!1,children:[m.map(e=>s.jsx(y,{value:e.nome,children:e.nome},e.id)),p&&!a.find(e=>e.nome===p)&&s.jsx(y,{value:p,children:p},"new")]})})]}),s.jsx(i.Item,{name:"cpf",label:"CPF",rules:[{required:!0,message:"Por favor, insira o CPF!"},()=>({validator(e,r){const c=r==null?void 0:r.replace(/[^\d]/g,"");return!r||J(c)?Promise.resolve():Promise.reject(new Error("CPF inválido!"))}})],children:s.jsx(P,{mask:"999.999.999-99",children:e=>s.jsx(f,{...e,placeholder:"999.999.999-99"})})})]}),s.jsx(S,{}),s.jsxs(z,{children:[s.jsx(E,{onClick:D,children:"Cancelar"}),s.jsx(E,{onClick:q,type:"primary",children:"Salvar Cadastro"})]})]})};export{oe as A};
