import{r as t,b as xe,u as je,e as Pe,c as _,j as e,B as y}from"./index-F_APLYFk.js";import{i as ve,W as Se}from"./index-BW7ljoM0.js";import{p as Te,q as z,r as Ce}from"./Styles-t47KmDAN.js";import{B as p}from"./index-BGmgU-6m.js";import{R as Ee}from"./ReCAPTCHAUtil-DByATj3I.js";import{M}from"./index-CuE4LayX.js";import{S as B}from"./index-DnBgSL8i.js";import{I as L}from"./index-CF94sgcy.js";import{B as we}from"./context-BBgDGUKR.js";import{m as n}from"./index-BZ8NrSYz.js";import{W as O}from"./WarningOutlined-D6lJ5C0F.js";const Ie=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,ke=["gmail.com","yahoo.com","hotmail.com","outlook.com","live.com"],Ue=({isVisible:U,onClose:q,onLoginSuccess:F,selectedService:m})=>{const[c,T]=t.useState(""),[C,N]=t.useState(""),[E,W]=t.useState(null),[h,u]=t.useState(!1),[J,G]=t.useState(!1),[d,w]=t.useState(null),V=xe(),{serviceId:f}=V.state||{serviceId:null},[s,H]=t.useState({plan:"",monthlyPrice:0,anualPrice:0}),[I,K]=t.useState(null),[Q,x]=t.useState(!1),X=je(),[k,j]=t.useState([]),[A,Y]=t.useState(""),[Z,P]=t.useState(!1),{authData:ee}=Pe(),ae=ee.companyID,[D,oe]=t.useState(""),[$,b]=t.useState(""),v=t.useRef(null),te=a=>Ie.test(a),re=a=>{if(a.includes("@")){const o=a.split("@"),r=o[1],i=ke.filter(l=>l.startsWith(r)).map(l=>o[0]+"@"+l);j(i)}else j([])},se=a=>{const o=a.target.value;T(o),re(o)},ne=a=>{T(a),j([])},ie=async a=>{try{const r=await(await fetch(`${y}/auth/check-email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a,company_id:ae})})).json();W(r.exists),r.exists||(n.info("Seu email nÃ£o existe em nosso cadastro, por favor faÃ§a seu cadastro e aproveite 7 dias grÃ¡tis para testar o Marquei"),P(!0))}catch(o){n.error("Error checking email: "+o.message)}},le=()=>{X("/cadastro"),P(!1)},ce=async a=>{if(a.preventDefault(),!te(c)){n.error("Por favor, insira um email valido");return}u(!0),await ie(c),u(!1)},de=async a=>{if(a.preventDefault(),u(!0),!$){oe("Por favor, confirme que vocÃª nÃ£o Ã© um robÃ´.");return}try{const o=await fetch(`${y}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:c,password:C,recaptchaToken:$})}),r=await o.json();o.ok?(sessionStorage.setItem("authToken",r.token),G(!0),F(r),S(m.serviceId)):(n.error(r.message||"Failed to login. Please check your credentials."),b(""))}catch(o){n.error("An error occurred while trying to log in: "+o.message),v.current&&v.current.reset()}u(!1)};t.useEffect(()=>{m.serviceId&&S(m.serviceId)},[m.serviceId]),t.useEffect(()=>{ve("TEST-c12efe3e-56fd-49b6-a560-dd5d3b700102",{locale:"pt-BR"}),f&&S(f)},[f]);const S=async a=>{try{const o=await _.get(`/service_details/${a}`);H({plan:o.data.plan,monthlyPrice:o.data.price,anualPrice:o.data.anualPrice,persons:o.data.persons}),Y(o.data.preapproval_plan_id)}catch(o){console.error("Erro ao carregar detalhes do serviÃ§o:",o)}},me=async a=>{try{const r=(await _.post("/create_preference",{itemDetails:a})).data.id;K(r),x(!1),R()}catch(o){console.error("Erro ao criar a preferÃªncia de pagamento:",o),x(!1)}},g=async(a,o)=>{const r=sessionStorage.getItem("authToken");if(a==="monthly"){if(!A){n.error("ID de plano de aprovaÃ§Ã£o prÃ©via nÃ£o encontrado. Por favor, tente novamente mais tarde.");return}const i={payment_type:"mensal",payment_email:c};try{const l=await fetch(`${y}/companies/updatePaymentInfo`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(i)}),ye=await l.json();if(l.ok){const fe=`https://www.mercadopago.com/mlb/debits/new?preapproval_plan_id=${A}`;window.location.href=fe}else n.error(`Erro ao atualizar informaÃ§Ãµes de pagamento: ${ye.error||"Erro desconhecido"}`)}catch(l){console.error("Erro ao enviar dados de pagamento:",l),n.error("Erro ao enviar informaÃ§Ãµes de pagamento.")}}else{const i={title:`Plano ${s.plan}`,unit_price:a==="anual"?s.anualPrice:s.monthlyPrice,description:`Plano ${s.plan} - ${a==="anual"?"Anual":"Mensal"}`};w(a),x(!0),me(i)}},pe=()=>s.monthlyPrice*12-s.anualPrice,R=async()=>{const a=sessionStorage.getItem("authToken");if(!a){n.error("VocÃª precisa estar logado para realizar o pagamento.");return}const r={payment_type:d==="monthly"?"mensal":"anual",payment_email:c};try{const i=await fetch(`${y}/companies/updatePaymentInfo`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(r)}),l=await i.json();i.ok||n.error(`Erro: ${l.error}`)}catch(i){console.error("Erro ao enviar dados de pagamento:",i),n.error("Erro ao enviar informaÃ§Ãµes de pagamento.")}},he=a=>{R()},ue={visual:{borderRadius:"6px",color:"white"},texts:{action:"pay",valueProp:"security_details"}},ge=()=>J?d?e.jsxs("div",{children:[e.jsxs("h2",{children:["VocÃª selecionou o ",d==="monthly"?"Plano Mensal":"Plano Anual"," de pagamento"]}),Q?e.jsx(B,{size:"large"}):d&&I&&e.jsx(Se,{customization:ue,initialization:{preferenceId:I},onPaymentSuccess:he}),e.jsxs(Ce,{children:[e.jsxs("p",{children:["Ao clicar em Pagar vocÃª serÃ¡ redirecionado para o ambiente seguro do Mercado Pago, o valor a ser pago no plano anual serÃ¡  ",e.jsxs("b",{children:["R$ ",s.anualPrice]})," e pode ser parcelado*"]}),e.jsx("p",{children:"Utilize o mesmo e-mail logado no pagamento !"})]}),e.jsx(we,{style:{textAlign:"center",width:"100%",marginTop:"1rem"},onClick:()=>w(null),children:"Alterar Plano de Pagamento"})]}):e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{children:"Escolha o tipo de pagamento"}),e.jsxs("p",{children:[e.jsx(O,{})," Ao pagar utilize o mesmo e-mail logado !"]}),e.jsxs(Te,{children:[e.jsxs(z,{selected:d==="anual",onClick:()=>g("anual"),children:[e.jsx("h2",{children:e.jsx("strong",{children:"Plano Anual ğŸ¤©"})}),e.jsxs("h3",{children:["Use 12 meses pagando por 10 e Economize R$ ",pe().toFixed(2)," ao ano!"]}),e.jsxs("h2",{children:["Pagando Apenas R$ ",(s.anualPrice/12).toFixed(2)," por mÃªs"]}),e.jsxs("div",{children:[s.persons," profissional(is) teram acesso a plataforma"]}),e.jsx(p,{onClick:a=>{a.stopPropagation(),g("anual")},children:"Contratar  ğŸ¤"})]}),e.jsxs(z,{selected:d==="monthly",onClick:()=>g("monthly"),children:[e.jsx("h2",{children:e.jsx("strong",{children:"Plano Mensal ğŸ’¸"})}),e.jsx("h3",{children:"Pagamento mÃªs a mÃªs..."}),e.jsxs("h2",{children:["R$ ",s.monthlyPrice," por mÃªs"]}),e.jsxs("div",{children:[s.persons," profissional(is) teram acesso a plataforma"]}),e.jsx(p,{onClick:a=>{a.stopPropagation(),g("monthly")},children:"Contratar  ğŸ¤"})]})]}),e.jsxs("p",{children:[e.jsx(O,{})," Ao pagar utilize o mesmo e-mail logado !"]})]}):e.jsx("div",{children:e.jsxs("form",{onSubmit:ce,children:[e.jsx(L,{type:"email",value:c,onChange:se,placeholder:"Insira seu E-mail",required:!0,style:{marginBottom:"1rem"}}),k.length>0&&e.jsx("div",{style:{marginTop:"0.5rem",background:"#f7f7f7",padding:"0.5rem"},children:k.map((a,o)=>e.jsx("div",{style:{cursor:"pointer",padding:"0.5rem"},onClick:()=>ne(a),children:a},o))}),E&&e.jsxs(e.Fragment,{children:[e.jsx(L,{style:{marginTop:"1rem"},type:"password",value:C,onChange:a=>N(a.target.value),placeholder:"Insira sua senha",required:!0}),D&&e.jsx("div",{children:D}),e.jsx("div",{style:{display:"flex",justifyContent:"center",margin:"15px 0 10px 0"},children:e.jsx(Ee,{ref:v,onChange:a=>b(a)})}),e.jsx(p,{style:{textAlign:"center",width:"100%",marginTop:"1rem"},type:"primary",onClick:de,loading:h,children:"Login"})]}),!E&&!h&&e.jsx(p,{style:{textAlign:"center",width:"100%",height:"20px"},htmlType:"submit",loading:h,children:"Continue"})]})});return e.jsxs(e.Fragment,{children:[e.jsxs(M,{title:"Cadastre-se / Entrar",open:U,onCancel:q,footer:null,children:[e.jsxs("p",{children:["Plano ",m.servicePlan]}),e.jsx("div",{style:{textAlign:"center"},children:h?e.jsx(B,{size:"large"}):ge()})]}),e.jsxs(M,{title:"Teste GrÃ¡tis ğŸ˜®",open:Z,onCancel:()=>P(!1),footer:null,children:[e.jsx("p",{children:"Seu e-mail nÃ£o existe em nosso cadastro, por favor faÃ§a seu cadastro e aproveite 7 dias grÃ¡tis para testar o Marquei !"}),e.jsx(p,{style:{textAlign:"center",width:"100%",marginTop:"1rem"},type:"primary",onClick:le,children:"Testar GrÃ¡tis Por 7 Dias ğŸ˜ƒ"})]})]})};export{Ue as A};
