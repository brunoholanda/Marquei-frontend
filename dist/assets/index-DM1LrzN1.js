import{r as s,e as F,u as L,c as d,j as o}from"./index-DtAKxO-I.js";import{d as q}from"./debounce-C6KaGSTg.js";/* empty css                      */import{A as U}from"./AddClientsModal-C_63WXIQ.js";import{B as u}from"./context-DBlOovQj.js";import{T as V}from"./Table-CnNBZ0wE.js";import{I as K,E as N}from"./index-Bh7spuOb.js";import{s as Z}from"./index-BvngcNS3.js";import{W as $}from"./WhatsAppOutlined-COd53Bo_.js";import{m as G}from"./index-ckeLVLhX.js";import{T as J}from"./TeamOutlined-C3uvPNxQ.js";import{W as Q}from"./WarningFilled-BuXJVxQa.js";import{P as X}from"./PlusOutlined-BxpqDW30.js";import"./index-BFpPU777.js";import"./commonMailDomains-C8uuVB4t.js";import"./Styles-B5msiCGj.js";import"./styled-components.browser.esm-Bk05TAV1.js";import"./Serializer-CQbcCsmu.js";import"./index-DVTGV1Ty.js";import"./useSize-CI_ZKiRx.js";import"./AntdIcon-yIvRgVWP.js";import"./index-BMUJ3kY3.js";import"./index-CFnU9gTT.js";import"./render-DxYmgcxZ.js";import"./row-Pvs6HpoF.js";import"./responsiveObserver-CzKOeKup.js";import"./useLocale-CKM3KW2_.js";import"./ExclamationCircleFilled-BDkHAKsa.js";import"./index-53RB1vmR.js";import"./InfoCircleFilled-D2hARdve.js";import"./KeyCode-BDlL2ZxM.js";import"./PurePanel-DTnqM39y.js";import"./index-gnFUhh9P.js";import"./CalendarOutlined-BHHeKPdf.js";import"./ClockCircleOutlined-yAqJ-m-N.js";import"./SearchOutlined-Bb9Je5JO.js";import"./index-DsB5NFMg.js";import"./Overflow-CxvXknPO.js";import"./CheckOutlined-R07Mhy7g.js";import"./index-Cpu2Yaof.js";import"./useForceUpdate-BYOE0HjS.js";import"./index-DO0v0281.js";import"./EllipsisOutlined-DPUGTPVO.js";import"./index-DmqRj2CN.js";import"./index-BZp-_p2x.js";import"./index-GgFpFduT.js";import"./Dropdown-zyi7t3e9.js";import"./index-DBBspAOI.js";import"./useNotification-CiPFwKzO.js";const{Search:Y}=K,Je=()=>{const[m,S]=s.useState(window.innerWidth<768),[v,h]=s.useState([]),[P,i]=s.useState(!1),[f]=s.useState(null),[w]=s.useState([]);s.useState(!0);const[x,k]=s.useState(""),[I,b]=s.useState(!1),[y,D]=s.useState(1);s.useState(0);const[M,W]=s.useState(0),{authData:z}=F(),n=z.companyID,O=()=>{b(!0)};s.useEffect(()=>{(async()=>{if(n)try{const t=await d.get(`/companies/${n}`);k(t.data.nome)}catch(t){console.error("Erro ao buscar nome do consultório:",t),c("error","Erro ao buscar nome do consultório.")}})()},[n]);const R=L(),c=(e,t)=>{Z[e]({message:t})},_=q(async e=>{const t=e.replace(/[^a-zA-Z0-9]/g,"");if(t.trim()){if(i(!0),!n){i(!1),c("error","Erro ao identificar a empresa. Por favor, faça login novamente.");return}try{const a=await d.get("/clients/search",{params:{searchTerm:t.trim(),company_id:n}});a.data.length>0?h(a.data):c("info","Nenhum cliente encontrado com os dados fornecidos.")}catch(a){console.error("Erro na pesquisa:",a),c("error","Erro ao realizar a pesquisa.")}i(!1)}},400),j=e=>{R(`/client-details/${e}`,{state:{from:"Pacientes"}})},E=()=>{const e=new Date().getHours();return e>=0&&e<12?"bom dia":e>=12&&e<18?"boa tarde":"boa noite"};s.useEffect(()=>{const e=()=>S(window.innerWidth<768);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const T=e=>{const t=e.split(" ");return t.length>3?`${t[0]} ${t[1]} ${t[2]}`:e},C=[{title:"Nome",dataIndex:"nome",key:"nome",render:e=>m?T(e):e}];m?C.push({title:"Ação",key:"action",render:(e,t)=>{const a=t.nome.split(" ")[0],l=E(),p=`Oi, ${a} ${l}, sou do consultório ${x}, tudo bem?`;return o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"fit-content",alignItems:"center"},children:[o.jsx(u,{type:"primary",onClick:()=>j(t.id),icon:o.jsx(N,{}),children:!m&&"Detalhes"}),o.jsx(u,{className:"button-whats modal-btn",onClick:()=>{const r=t.celular.replace(/[^0-9]/g,"");window.open(`https://api.whatsapp.com/send?phone=+55${r}&text=${encodeURIComponent(p)}`,"_blank")},icon:o.jsx($,{}),children:!m&&"Conversar"},`whatsapp-${t.id}`)]})}}):C.push({title:"CPF",dataIndex:"cpf",key:"cpf"},{title:"Celular",dataIndex:"celular",key:"celular"},{title:"Ação",key:"action",render:(e,t)=>{const a=t.nome.split(" ")[0],l=E(),p=`Oi, ${a} ${l}, sou do consultório ${x}, tudo bem?`;return o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"fit-content",alignItems:"center"},children:[o.jsxs(u,{type:"primary",onClick:()=>j(t.id),children:["Detalhes ",o.jsx(N,{})]}),o.jsxs(u,{className:"button-whats modal-btn",onClick:()=>{const r=t.celular.replace(/[^0-9]/g,"");window.open(`https://api.whatsapp.com/send?phone=+55${r}&text=${encodeURIComponent(p)}`,"_blank")},children:["Conversar ",o.jsx($,{})]},`whatsapp-${t.id}`)]})}});const A=e=>{const t=e.split("/");return new Date(t[2],t[1]-1,t[0])};s.useEffect(()=>{if(i(!0),!n){i(!1),c("error","Erro ao identificar a empresa. Por favor, faça login novamente.");return}d.get("/clients",{params:{company_id:n,page:y}}).then(e=>{const t=e.data.data.sort((a,l)=>a.nome.localeCompare(l.nome));h(t),W(e.data.total),i(!1)}).catch(e=>{console.error("Erro ao buscar clientes:",e),c("error","Erro ao buscar clientes."),i(!1)})},[y,n]),s.useEffect(()=>{(async()=>{if(f&&f.id)try{const a=(await d.get("/todos-agendamentos-hard",{params:{client_id:f.id,company_id:n}})).data.filter(r=>r.status===1),p=(await Promise.all(a.map(async r=>{const g=await d.get(`/professionals/${r.professional_id}`);return r.professionalName=g.data.nome,r}))).sort((r,g)=>{const H=A(r.data);return A(g.data)-H});w(p)}catch(t){console.error("Erro ao buscar histórico de atendimentos",t),G.error("Erro ao buscar histórico de atendimentos")}})()},[f,n,w]);const B=e=>{h(t=>[...t,e])};return o.jsxs("div",{className:"tabela",children:[o.jsxs("h1",{children:["Clientes ",o.jsx(J,{})]}),o.jsxs("p",{children:["Utilize a lupa para pesquisar por Nome ou CPF ",o.jsx(Q,{})]}),o.jsx(Y,{placeholder:"Digite o nome ou CPF",onSearch:_,style:{width:m?"100%":"50%",marginBottom:20}}),o.jsxs(u,{style:{marginLeft:"15px"},type:"primary",onClick:O,children:[o.jsx(X,{})," Adicionar Cliente"]}),o.jsx(V,{columns:C,dataSource:v,rowKey:"id",loading:P,pagination:{current:y,pageSize:10,total:M,onChange:e=>{D(e)}}}),o.jsx(U,{isModalAddClientsVisible:I,onCloseAddClients:()=>b(!1),onClientAdded:B})]})};export{Je as default};
