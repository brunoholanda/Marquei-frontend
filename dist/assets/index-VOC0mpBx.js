import{r as s,d as F,u as L,j as o}from"./index-kPzU05gx.js";import{a as p}from"./api-p_bhudRe.js";import{d as q}from"./debounce-sNexErV1.js";/* empty css                      */import{A as U}from"./AddClientsModal-CZH8hJFG.js";import{B as d}from"./context-Cu6KQni0.js";import{T as V}from"./Table-B0u-CeGd.js";import{I as K,E as N}from"./index-DdU0LtvV.js";import{s as Z}from"./index-DkzRl__G.js";import{W as $}from"./WhatsAppOutlined-DaG4geL-.js";import{m as G}from"./index-BfF3jSoh.js";import{T as J}from"./TeamOutlined-CEEC42gp.js";import{W as Q}from"./WarningFilled-C5xOC9CD.js";import{P as X}from"./PlusOutlined-CtSp6DS-.js";import"./index-BHFLF1lE.js";import"./commonMailDomains-C8uuVB4t.js";import"./Styles-CGctwYhX.js";import"./styled-components.browser.esm-BWH_c5t_.js";import"./Serializer-CQbcCsmu.js";import"./index-COTnBvfG.js";import"./useSize-Dir-JjEK.js";import"./AntdIcon-rDAQJIgd.js";import"./index-DvbXQ1GL.js";import"./index-DSAf5tNC.js";import"./render-CJmks47J.js";import"./useForm-sTvtv3Iy.js";import"./row-BdR9_GnZ.js";import"./responsiveObserver-BuWZJpCK.js";import"./useLocale-D_rXO8QB.js";import"./ExclamationCircleFilled-C5haNHtp.js";import"./index-DmsyNvo6.js";import"./InfoCircleFilled-aimHxtz3.js";import"./KeyCode-Bp2GxRS5.js";import"./PurePanel-DZZoC6Qu.js";import"./index-BUWDoS_L.js";import"./CalendarOutlined-FfBpZXtG.js";import"./ClockCircleOutlined---JEIzSM.js";import"./Overflow-DH1nb5VS.js";import"./SearchOutlined-BKygTbfa.js";import"./index-CDd_3z3j.js";import"./CheckOutlined-CJXAI-D_.js";import"./index-Bg0REs51.js";import"./index-BxaDw8tE.js";import"./index-qm-UxHX_.js";import"./EllipsisOutlined-CT_kym8T.js";import"./Dropdown-BnNsehg0.js";import"./useForceUpdate-B--ZqLvt.js";import"./index-C_g5XK6A.js";import"./context-Cq6TeAM8.js";const{Search:Y}=K,Jt=()=>{const[l,S]=s.useState(window.innerWidth<768),[v,h]=s.useState([]),[P,i]=s.useState(!1),[u]=s.useState(null),[C]=s.useState([]);s.useState(!0);const[x,k]=s.useState(""),[I,b]=s.useState(!1),[y,D]=s.useState(1);s.useState(0);const[M,W]=s.useState(0),{authData:z}=F(),r=z.companyID,O=()=>{b(!0)};s.useEffect(()=>{(async()=>{if(r)try{const e=await p.get(`/companies/${r}`);k(e.data.nome)}catch(e){console.error("Erro ao buscar nome do consultório:",e),c("error","Erro ao buscar nome do consultório.")}})()},[r]);const R=L(),c=(t,e)=>{Z[t]({message:e})},_=q(async t=>{const e=t.replace(/[^a-zA-Z0-9]/g,"");if(e.trim()){if(i(!0),!r){i(!1),c("error","Erro ao identificar a empresa. Por favor, faça login novamente.");return}try{const n=await p.get("/clients/search",{params:{searchTerm:e.trim(),company_id:r}});n.data.length>0?h(n.data):c("info","Nenhum cliente encontrado com os dados fornecidos.")}catch(n){console.error("Erro na pesquisa:",n),c("error","Erro ao realizar a pesquisa.")}i(!1)}},400),j=t=>{R(`/client-details/${t}`,{state:{from:"Pacientes"}})},E=()=>{const t=new Date().getHours();return t>=0&&t<12?"bom dia":t>=12&&t<18?"boa tarde":"boa noite"};s.useEffect(()=>{const t=()=>S(window.innerWidth<768);return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const T=t=>{const e=t.split(" ");return e.length>3?`${e[0]} ${e[1]} ${e[2]}`:t},g=[{title:"Nome",dataIndex:"nome",key:"nome",render:t=>l?T(t):t}];l?g.push({title:"Ação",key:"action",render:(t,e)=>{const n=e.nome.split(" ")[0],f=E(),m=`Oi, ${n} ${f}, sou do consultório ${x}, tudo bem?`;return o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"fit-content",alignItems:"center"},children:[o.jsx(d,{type:"primary",onClick:()=>j(e.id),icon:o.jsx(N,{}),children:!l&&"Detalhes"}),o.jsx(d,{className:"button-whats modal-btn",onClick:()=>{const a=e.celular.replace(/[^0-9]/g,"");window.open(`https://api.whatsapp.com/send?phone=+55${a}&text=${encodeURIComponent(m)}`,"_blank")},icon:o.jsx($,{}),children:!l&&"Conversar"},`whatsapp-${e.id}`)]})}}):g.push({title:"CPF",dataIndex:"cpf",key:"cpf"},{title:"Celular",dataIndex:"celular",key:"celular"},{title:"Ação",key:"action",render:(t,e)=>{const n=e.nome.split(" ")[0],f=E(),m=`Oi, ${n} ${f}, sou do consultório ${x}, tudo bem?`;return o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"fit-content",alignItems:"center"},children:[o.jsxs(d,{type:"primary",onClick:()=>j(e.id),children:["Detalhes ",o.jsx(N,{})]}),o.jsxs(d,{className:"button-whats modal-btn",onClick:()=>{const a=e.celular.replace(/[^0-9]/g,"");window.open(`https://api.whatsapp.com/send?phone=+55${a}&text=${encodeURIComponent(m)}`,"_blank")},children:["Conversar ",o.jsx($,{})]},`whatsapp-${e.id}`)]})}});const A=t=>{const e=t.split("/");return new Date(e[2],e[1]-1,e[0])};s.useEffect(()=>{if(i(!0),!r){i(!1),c("error","Erro ao identificar a empresa. Por favor, faça login novamente.");return}p.get("/clients",{params:{company_id:r,page:y}}).then(t=>{h(t.data.data),W(t.data.total),i(!1)}).catch(t=>{console.error("Erro ao buscar clientes:",t),c("error","Erro ao buscar clientes."),i(!1)})},[y,r]),s.useEffect(()=>{(async()=>{if(u&&u.id)try{const n=(await p.get("/todos-agendamentos-hard",{params:{client_id:u.id,company_id:r}})).data.filter(a=>a.status===1),m=(await Promise.all(n.map(async a=>{const w=await p.get(`/professionals/${a.professional_id}`);return a.professionalName=w.data.nome,a}))).sort((a,w)=>{const H=A(a.data);return A(w.data)-H});C(m)}catch(e){console.error("Erro ao buscar histórico de atendimentos",e),G.error("Erro ao buscar histórico de atendimentos")}})()},[u,r,C]);const B=t=>{h(e=>[...e,t])};return o.jsxs("div",{className:"tabela",children:[o.jsxs("h1",{children:["Clientes ",o.jsx(J,{})]}),o.jsxs("p",{children:["Utilize a lupa para pesquisar por Nome ou CPF ",o.jsx(Q,{})]}),o.jsx(Y,{placeholder:"Digite o nome ou CPF",onSearch:_,style:{width:l?"100%":"50%",marginBottom:20}}),o.jsxs(d,{style:{marginLeft:"15px"},type:"primary",onClick:O,children:[o.jsx(X,{})," Adicionar Cliente"]}),o.jsx(V,{columns:g,dataSource:v,rowKey:"id",loading:P,pagination:{current:y,pageSize:10,total:M,onChange:t=>{D(t)}}}),o.jsx(U,{isModalAddClientsVisible:I,onCloseAddClients:()=>b(!1),onClientAdded:B})]})};export{Jt as default};
